# Troubleshooting Case: Installing SSL certificates on Synology
# 故障排除实战案例: 在群晖/黑群晖上安装SSL证书


#### 目标 ####
由于Synology（群晖）的系统在多处需要使用SSL证书，比如其自身的5001管理员HTTPS界面，或者443的网站界面，或者WebDAV等……DSM系统在出厂时内置一份由Synology公司颁布的证书，但是这个证书与机器的域名不匹配，所以不建议使用，故而需要自己重新申请一个。我们这次的目标是已经通过yourdomain.name生成一个key和对应的csr，并且通过API提交到letsencrypt.com上，请求一个证书，并且把这个证书部署到群晖上。

“不就是申请和部署一个证书嘛！”听起来很简单，是不？

然而，真正撸起袖子干起来，才体会到这其中困难重重，一个坑接一个坑。一共花了将近一整天的时间才最终搞定。为了纪念逝去的时间，现将钻研过程中遇到的心得分享于此。

#### 起因 ####
公司的网管已经在防火墙上禁了File Sharing / SMB 的端口，导致在公司以外就无法访问文件共享，因而只得通过在群晖上安装并启用WebDAV方式的文件共享。群晖的共享很好地与WebDAV集成，因此在群晖的共享文件夹上启用WebDAV并不复杂，但是随之而来带来又一个问题：在Windows上没有WebDAV的客户端————要么用第三方付费的软件，要么用Windows的网络映射（Map network drive），但是后者需要强制使用HTTPS。总之，部署证书的目的：
* 为了直接在Windows客户端上访问通过WebDAV共享出来的文件
* 为了以后的443端口的HTTPS网站
* 为了管理界面登录时浏览器状态栏不显示红字（强迫症，呵呵）

#### 预备 ####
起初在公司以外发现无法访问公司群晖上HTTP WEB网站，还以为是系统的设置问题————于是花了很多时间在设置的排查上：
* 先是看群晖自己是不是防火墙，后来发现群晖DSM没有防火墙；
* 接着又以为是nginx的什么设置出错了，导致80，于是去把WebStation包卸载又重装，但是80端口依旧无法访问；
* 无法telnet 80端口，说明肯定是连接断了，而不是应用层的内部错误；
* 让同事在公司内部访问HTTP网站，成功；
* 联系了公司的网管，他让我把一些操作重复做了N遍，以反复确认……

最终得到的结论是:
1. 公司的网管没有在公司防火墙封锁80和443的TCP端口，但是很有可能是ISP（市级联通）把WEB的默认端口给封了，需要另行申请才能开通

#### 后记 ####
1. 在
